---
title: "Time Series"
author: "Brayan Duran Medina"
output: html_document
---

### Monthly beer production in Australia from 1956 to 1995

# Importing libraries
```{r, message=FALSE}
library(readxl)
library(dplyr)
library(ggplot2)
library(GGally)
library(ggcorrplot)
library(MASS)
library(lmtest)
library(forecast)
library(tseries)
library(Hmisc)
library(lubridate)
```

# Reading data
```{r}
data <- read.csv("monthly-beer-production-in-austr.csv",
                 header = TRUE, sep = ",")
head(data)
```

# Preparing data
```{r}
names(data)[1] <- "Date"
names(data)[2] <- "Value"

title <- "Monthly beer production in Australia"

data$Value <- as.numeric(data$Value)
data$Date <- as.Date(as.yearmon(data$Date, format = "%Y-%m"))

head(data)
```

# Creating time series
```{r}
time_series <- ts(data = data$Value, start =
                    as.numeric(c(format(data$Date[1], "%Y"),
                                 format(data$Date[1], "%m"))), freq = 12)
```

# Plotting data
```{r}
plot(time_series, type = "l", ylab = title, col = "red")

grid()
```

### Notes:
We have too many years in the data, so the forecast will be very inaccurate. 
So then we will only use the data from 1975 to 1995, that is the last 20 years.

# Cutting data to keep only the last 20 years
```{r}
data <- data[format(data$Date, "%Y") >= 1975, ]
```

# Creating new time series with the last 20 years
```{r}
time_series <- ts(data = data$Value, start =
                    as.numeric(c(format(data$Date[1], "%Y"),
                                 format(data$Date[1], "%m"))), freq = 12)
```

# Plotting new time series
```{r}
plot(time_series, type = "l", ylab = title, col = "red")

grid()
```

# STL decomposition
```{r, fig.width=10, fig.height=10}
plot(stl(time_series, s.window = "periodic"))
```

# Make Box-Cox transformation
```{r, fig.width=10, fig.height=10}
par(mfrow = c(2, 1))

plot(time_series, ylab = "Original series", xlab = "", col = "red")
grid()

lambda <- BoxCox.lambda(time_series)

time_series_transformed <- BoxCox(time_series, lambda)

plot(time_series_transformed,
     ylab = "Transformed series", xlab = "", col = "red")

title(main = toString(round(lambda, 3)))

grid()
```